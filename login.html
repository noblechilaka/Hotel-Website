<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | Luxury Hotel</title>
    <meta
      name="description"
      content="Sign in to your Luxury Hotel account to manage your bookings."
    />

    <!-- Fonts -->
    <link rel="preconnect" href="https:/fonts.googleapis.com" />
    <link rel="preconnect" href="https:/fonts.gstatic.com" crossorigin />
    <link
      href="https:/fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400&display=swap"
      rel="stylesheet"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="/styles/global.css" />
    <link rel="stylesheet" href="/styles/typography.css" />
    <link rel="stylesheet" href="/styles/layout.css" />
    <link rel="stylesheet" href="/styles/components.css" />
    <link rel="stylesheet" href="/styles/animations.css" />

    <!-- GSAP -->
    <script src="https:/cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  </head>
  <body class="auth-page bg-dark">
    <!-- Header -->

    <!-- Header -->
    <header class="header">
      <div class="header-inner">
        <!-- Menu Toggle - Left -->
        <button
          class="header-menu"
          id="menuToggle"
          aria-label="Open navigation menu"
        >
          <div class="menu-icon">
            <span></span>
            <span></span>
          </div>
          <span class="menu-text">MENU</span>
        </button>

        <!-- Logo - Centered -->
        <div class="header-logo">
          <a href="/index.html" class="logo">EMILY HOTEL</a>
        </div>

        <!-- Navigation - Right -->
        <nav class="header-nav-right">
          <a href="signup.html" class="nav-link">JOIN US</a>
          <!-- Submit Button -->
          <button type="submit" class="booking-cta" id="bookNowBtn">
            BOOK NOW
          </button>
        </nav>

        <!-- Mobile Menu Toggle -->
        <button
          class="menu-toggle"
          aria-label="Toggle navigation"
          style="
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            display: none;
          "
        >
          <svg
            xmlns="http:/www.w3.org/2000/svg"
            x="0px"
            y="0px"
            width="24"
            height="24"
            viewBox="0 0 32 32"
          >
            <path
              d="M 4 7 L 4 9 L 28 9 L 28 7 L 4 7 z M 4 15 L 4 17 L 28 17 L 28 15 L 4 15 z M 4 23 L 4 25 L 28 25 L 28 23 L 4 23 z"
            ></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- Navigation Menu Panel -->
    <div
      class="menu-overlay"
      id="menuOverlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
    >
      <nav class="menu-panel" aria-label="Main navigation">
        <ul class="menu-list">
          <li class="menu-item">
            <a href="index.html" class="menu-link">Home</a>
          </li>
          <li class="menu-item">
            <a href="rooms.html" class="menu-link">Rooms & Suites</a>
          </li>
          <li class="menu-item">
            <a href="about.html" class="menu-link">About Us</a>
          </li>
          <li class="menu-item">
            <a href="#" class="menu-link">Experiences</a>
          </li>
          <li class="menu-item"><a href="#" class="menu-link">Gallery</a></li>
          <li class="menu-item">
            <a href="contact.html" class="menu-link">Contact</a>
          </li>
          <li class="menu-item menu-divider"></li>
          <li class="menu-item">
            <a href="#" class="menu-link menu-link-secondary">JOIN US</a>
          </li>
          <li class="menu-item">
            <a href="#" class="menu-link menu-link-cta">Book Your Stay</a>
          </li>
        </ul>
        <button
          class="menu-close"
          id="menuClose"
          aria-label="Close navigation menu"
        >
          Close
        </button>
      </nav>
    </div>

    <main
      style="
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-xl) var(--container-padding);
      "
    >
      <div style="width: 100%; max-width: 420px">
        <!-- Logo -->
        <div style="text-align: center; margin-bottom: 3rem">
          <a href="/index.html" style="display: inline-block">
            <span class="logo" style="font-size: 2rem; color: var(--text-light)"
              >LOGIN</span
            >
          </a>
        </div>

        <!-- Auth Card -->
        <div
          class="auth-card"
          style="background: var(--bg-light); padding: 3rem; border-radius: 4px"
        >
          <!-- Back Link -->
          <a
            href="/index.html"
            class="btn-text-only dark"
            style="
              display: inline-flex;
              align-items: center;
              gap: 0.5rem;
              margin-bottom: 2rem;
              color: var(--text-dark);
            "
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Back to Home
          </a>

          <!-- Title -->
          <h1
            class="section-title"
            style="font-size: 2rem; margin-bottom: 0.5rem"
          >
            Welcome Back
          </h1>
          <p class="body-text dark" style="margin-bottom: 2rem">
            Sign in to access your account
          </p>

          <!-- Error/Success Messages -->
          <div id="authError" style="margin-bottom: 1.5rem"></div>
          <div id="authSuccess" style="margin-bottom: 1.5rem"></div>

          <!-- Login Method Tabs -->
          <div class="login-tabs" style="display: flex; gap: 0.5rem; margin-bottom: 2rem;">
            <button type="button" id="tabEmail" class="tab-btn active" style="flex: 1; padding: 0.75rem; border: 1px solid var(--divider); background: var(--bg-dark); color: var(--text-light); cursor: pointer; border-radius: 4px;">
              Email
            </button>
            <button type="button" id="tabPhone" class="tab-btn" style="flex: 1; padding: 0.75rem; border: 1px solid var(--divider); background: transparent; color: var(--text-light); cursor: pointer; border-radius: 4px;">
              Phone
            </button>
          </div>

          <!-- Email Login Section -->
          <div id="emailLoginSection">
            <!-- Login Form -->
            <form id="loginForm">
            <div class="form-group">
              <label class="form-label" for="email">Email Address</label>
              <input
                type="email"
                id="email"
                name="email"
                class="form-field"
                placeholder="your@email.com"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="password">Password</label>
              <div class="input-wrapper">
                <input
                  type="password"
                  id="password"
                  name="password"
                  class="form-field"
                  placeholder="Enter your password"
                  required
                />
                <button
                  type="button"
                  class="toggle-password"
                  style="
                    position: absolute;
                    right: 0;
                    top: 50%;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    cursor: pointer;
                    padding: 0.5rem;
                  "
                >
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="var(--brown)"
                    stroke-width="1.5"
                  >
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                    <circle cx="12" cy="12" r="3" />
                  </svg>
                </button>
              </div>
            </div>

            <!-- Remember & Forgot -->
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 2rem;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 0.5rem;
                  cursor: pointer;
                "
              >
                <input type="checkbox" style="accent-color: var(--gold)" />
                <span class="body-text" style="font-size: 0.875rem"
                  >Remember me</span
                >
              </label>
              <a
                href="reset-password.html"
                class="btn-text-only dark"
                style="color: var(--text-dark); font-size: size 5px"
                >Forgot Password?</a
              >
            </div>

            <button
              type="submit"
              id="loginBtn"
              class="btn btn-primary gold"
              style="width: 100%; justify-content: center"
            >
              Sign In
            </button>
          </form>

          <!-- Divider -->
          <div
            style="
              display: flex;
              align-items: center;
              gap: 1rem;
              margin: 2rem 0;
            "
          >
            <div style="flex: 1; height: 1px; background: var(--divider)"></div>
            <span class="meta-text" style="color: var(--brown)">or</span>
            <div style="flex: 1; height: 1px; background: var(--divider)"></div>
          </div>

          <!-- Sign Up Link -->
          <p
            class="body-text dark"
            style="text-align: center; font-size: 0.875rem"
          >
            Don't have an account?
            <a
              href="signup.html"
              class="btn-text-only dark"
              style="color: var(--gold)"
              >Create Account</a
            >
          </p>
          </div>

          <!-- Phone Login Section -->
          <div id="phoneLoginSection" style="display: none;">
            <!-- Phone Input -->
            <div id="phoneInputSection">
              <div class="form-group">
                <label class="form-label" for="phoneLogin">Phone Number</label>
                <input
                  type="tel"
                  id="phoneLogin"
                  class="form-field"
                  placeholder="+234 800 123 4567"
                />
                <p class="body-text" style="font-size: 0.75rem; margin-top: 0.5rem; color: var(--brown);">
                  Enter your phone number with country code
                </p>
              </div>
              <button
                type="button"
                id="sendOtpBtn"
                class="btn btn-primary gold"
                style="width: 100%; justify-content: center; margin-top: 1rem;"
              >
                Send Code
              </button>
            </div>

            <!-- OTP Verification -->
            <div id="otpSection" style="display: none;">
              <div class="form-group">
                <label class="form-label" for="otpInput">Verification Code</label>
                <input
                  type="text"
                  id="otpInput"
                  class="form-field"
                  placeholder="Enter 6-digit code"
                  maxlength="6"
                  style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;"
                />
                <p class="body-text" style="font-size: 0.75rem; margin-top: 0.5rem; color: var(--brown);">
                  Enter the code sent to your phone
                </p>
              </div>
              <button
                type="button"
                id="verifyOtpBtn"
                class="btn btn-primary gold"
                style="width: 100%; justify-content: center; margin-top: 1rem;"
              >
                Verify & Login
              </button>
              <button
                type="button"
                id="resendOtpBtn"
                class="btn-text-only dark"
                style="width: 100%; justify-content: center; margin-top: 1rem; color: var(--gold);"
              >
                Resend Code
              </button>
            </div>
          </div>
          </div>
        </div>

        <!-- Footer Note -->
        <p
          class="body-text"
          style="
            text-align: center;
            margin-top: 2rem;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
          "
        >
          By signing in, you agree to our
          <a href="terms.html" style="color: var(--gold)">Terms of Service</a>
          and
          <a href="privacy.html" style="color: var(--gold)">Privacy Policy</a>
        </p>
      </div>
    </main>

    <!-- Scripts -->
    <script src="/scripts/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script src="/scripts/supabase.js"></script>
    <script src="/scripts/auth.js"></script>

    <!-- Auth Form Script -->
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        // Initialize auth first
        await window.HotelAuth.init();

        const loginForm = document.getElementById("loginForm");
        const authError = document.getElementById("authError");
        const authSuccess = document.getElementById("authSuccess");
        const loginBtn = document.getElementById("loginBtn");

        // Tab switching
        const tabEmail = document.getElementById("tabEmail");
        const tabPhone = document.getElementById("tabPhone");
        const emailSection = document.getElementById("emailLoginSection");
        const phoneSection = document.getElementById("phoneLoginSection");
        const phoneInputSection = document.getElementById("phoneInputSection");
        const otpSection = document.getElementById("otpSection");

        // Password toggle
        const togglePasswordBtns =
          document.querySelectorAll(".toggle-password");
        togglePasswordBtns.forEach((btn) => {
          btn.addEventListener("click", () => {
            const input = btn.parentElement.querySelector("input");
            const type = input.type === "password" ? "text" : "password";
            input.type = type;
          });
        });

        // Tab switching logic
        if (tabEmail && tabPhone) {
          tabEmail.addEventListener("click", () => {
            tabEmail.classList.add("active");
            tabPhone.classList.remove("active");
            emailSection.style.display = "block";
            phoneSection.style.display = "none";
          });

          tabPhone.addEventListener("click", () => {
            tabPhone.classList.add("active");
            tabEmail.classList.remove("active");
            emailSection.style.display = "none";
            phoneSection.style.display = "block";
          });
        }

        // Send OTP button
        const sendOtpBtn = document.getElementById("sendOtpBtn");
        if (sendOtpBtn) {
          sendOtpBtn.addEventListener("click", async () => {
            const phone = document.getElementById("phoneLogin").value.trim();

            authError.innerHTML = "";
            authSuccess.innerHTML = "";

            if (!window.AuthValidator.isValidPhone(phone)) {
              authError.innerHTML =
                '<div class="alert alert-error">Please enter a valid phone number</div>';
              return;
            }

            sendOtpBtn.disabled = true;
            sendOtpBtn.textContent = "Sending...";

            const result = await window.HotelAuth.sendPhoneOTP(phone);

            if (result.success) {
              phoneInputSection.style.display = "none";
              otpSection.style.display = "block";
              authSuccess.innerHTML =
                '<div class="alert alert-success">' + result.message + "</div>";
            } else {
              authError.innerHTML =
                '<div class="alert alert-error">' + result.error + "</div>";
            }

            sendOtpBtn.disabled = false;
            sendOtpBtn.textContent = "Send Code";
          });
        }

        // Verify OTP button
        const verifyOtpBtn = document.getElementById("verifyOtpBtn");
        if (verifyOtpBtn) {
          verifyOtpBtn.addEventListener("click", async () => {
            const otp = document.getElementById("otpInput").value.trim();

            authError.innerHTML = "";
            authSuccess.innerHTML = "";

            if (!otp) {
              authError.innerHTML =
                '<div class="alert alert-error">Please enter the verification code</div>';
              return;
            }

            verifyOtpBtn.disabled = true;
            verifyOtpBtn.textContent = "Verifying...";

            const result = await window.HotelAuth.verifyPhoneOTP(otp);

            if (result.success) {
              window.location.href = "/dashboard.html";
            } else {
              authError.innerHTML =
                '<div class="alert alert-error">' + result.error + "</div>";
            }

            verifyOtpBtn.disabled = false;
            verifyOtpBtn.textContent = "Verify & Login";
          });
        }

        // Resend OTP
        const resendOtpBtn = document.getElementById("resendOtpBtn");
        if (resendOtpBtn) {
          resendOtpBtn.addEventListener("click", async () => {
            const phone = sessionStorage.getItem("otp_phone");
            if (phone) {
              resendOtpBtn.textContent = "Sending...";
              resendOtpBtn.disabled = true;

              const result = await window.HotelAuth.sendPhoneOTP(phone);

              if (result.success) {
                authSuccess.innerHTML =
                  '<div class="alert alert-success">New code sent!</div>';
              } else {
                authError.innerHTML =
                  '<div class="alert alert-error">' + result.error + "</div>";
              }

              resendOtpBtn.textContent = "Resend Code";
              resendOtpBtn.disabled = false;
            }
          });
        }

        // Email login form
        if (loginForm) {
          loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value;

            authError.innerHTML = "";
            authSuccess.innerHTML = "";

            if (!email) {
              authError.innerHTML =
                '<div class="alert alert-error">Please enter your email address</div>';
              return;
            }

            if (!window.AuthValidator.isValidEmail(email)) {
              authError.innerHTML =
                '<div class="alert alert-error">Please enter a valid email address</div>';
              return;
            }

            if (!password) {
              authError.innerHTML =
                '<div class="alert alert-error">Please enter your password</div>';
              return;
            }

            loginBtn.disabled = true;
            loginBtn.textContent = "Signing In...";

            const result = await window.HotelAuth.loginWithEmail(
              email,
              password
            );

            if (result.success) {
              window.location.href = "/dashboard.html";
            } else {
              authError.innerHTML =
                '<div class="alert alert-error">' + result.error + "</div>";
              loginBtn.disabled = false;
              loginBtn.textContent = "Sign In";
            }
          });
        }

        // Check for existing session
        const isLoggedIn = await window.HotelAuth.isLoggedIn();
        if (isLoggedIn) {
          window.location.href = "/dashboard.html";
        }

        // Check for email verification callback
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get("type") === "email_confirmation") {
          authSuccess.innerHTML =
            '<div class="alert alert-success">Email verified! Please log in.</div>';
        }
      });
    </script>
  </body>
</html>
